<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link rel="icon" type="image/png" href="/favicon.ico">
	
	
	<title>Santa Brings Cloud to Every Developer | Mikhail Shilkov</title>
	
	
	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	
	<link rel="stylesheet" href="/sass/main.css">

	
	
	<meta property="og:title" content="Santa Brings Cloud to Every Developer" />
	<meta property="og:description" content="How Santa Cloud uses F# and Pulumi to bring cloud resources to the homes of software engineers." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://mikhail.io/2019/12/santa-brings-cloud-to-every-developer/" />

	
	
	
	
	<meta property="og:image" content="https://mikhail.io/2019/12/santa-brings-cloud-to-every-developer/teaser.jpg" />
	
	


	
	
	<meta property="article:tag" content="Pulumi" />
	
	<meta property="article:tag" content="FSharp" />
	
	<meta property="article:tag" content="AWS" />
	
	<meta property="article:tag" content="Azure" />
	
	<meta property="article:tag" content="GCP" />
	

	
	
	<meta name="twitter:card" content="summary_large_image"/>
	
	<meta name="twitter:image" content="https://mikhail.io/2019/12/santa-brings-cloud-to-every-developer/teaser.jpg" />
	
	

	<meta name="twitter:title" content="Santa Brings Cloud to Every Developer"/>
	<meta name="twitter:description" content="How Santa Cloud uses F# and Pulumi to bring cloud resources to the homes of software engineers."/>
	<meta name="twitter:creator" content="@MikhailShilkov"></meta>
</head>
<body><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    function addChart(make) {
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            const data = new google.visualization.DataTable();

            const options = {
                height: 420,  
                chartArea: { width: '85%', height: '70%' },
                legend: 'none',
                hAxis: { minValue: 0 },
                vAxis: {},
                series: {      
                    0: { tooltip : false}
                }
            };
            const chart = make(data, options);
            options.hAxis.textStyle = options.hAxis.titleTextStyle 
                = options.vAxis.textStyle = options.vAxis.titleTextStyle = { fontName: 'Merriweather' };

            chart.draw(data, options);
        }
    }
</script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container pr-0">
        <a class="navbar-brand" href="/">
            <img class="author-thumb" src="/images/author.jpg" alt="Mikhail Shilkov">
            <span class="text-primary">Mikhail Shilkov</span>
        </a>

        
               


        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">TOPICS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/archives/">ARCHIVES</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/talks/">TALKS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">ABOUT</a>
                </li>
                <li class="nav-item">
    <a class="nav-link" href="https://mikhail.io/feed/"><i class="fas fa-rss social-icon" aria-hidden="true"></i></a>
</li>

<li class="nav-item">
    <a class="nav-link" href="https://x.com/MikhailShilkov"><i class="fab fa-twitter social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://dev.to/mikhailshilkov"><i class="fab fa-dev social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://medium.com/@MikhailShilkov"><i class="fab fa-medium social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://github.com/MikhailShilkov"><i class="fab fa-github social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/MikhailShilkov"><i class="fab fa-linkedin social-icon" aria-hidden="true"></i></a>
</li>

</ul>
        </div>
        
    </div>
</nav>


        <div class="container">

<div class="main-content">
    
    <div class="container">
        <div class="row">
            
            <div class="col-lg-2 pl-0"><div class="share">
    <ul>
        <li class="ml-1 mr-1" title="Say 'Thank You' for this article">
            <a href="#" onclick="heart();return false;">
                <i class="fas fa-heart" style="color: red"></i>
            </a>
            <div class="count" style="float: right; padding-left: .5em; padding-top: .25em" id="heartcount"></div>
        </li>

        <li class="ml-1 mr-1" title="Tweet this article">
            <a target="_blank"
                href="https://x.com/intent/tweet?text=Santa%20Brings%20Cloud%20to%20Every%20Developer%20by%20@MikhailShilkov&url=https%3a%2f%2fmikhail.io%2f2019%2f12%2fsanta-brings-cloud-to-every-developer%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1" title="See the responses or write a response">
            <a href="#comments">
                <i class="fas fa-comment"></i>
            </a>
        </li>
    </ul>
</div></div>
            
            <div class="col-lg-9 flex-first flex-lg-unordered">

                <div class="mainheading">
                    
                    <h1 class="posttitle">Santa Brings Cloud to Every Developer</h1>
                    
                    <div class="post-top-meta">
                        <div>
                            
                                
                                <span class="post-date">Published on Dec 1, 2019
                                
                            
                            
                        &nbsp;&middot;&nbsp; 6 min read</span></span>
                        </div>
                    </div>
                </div>
                
                
                

                
                <div class="article-post">
                    <p><em>The post is a part of
<a href="https://sergeytihon.com/2019/11/05/f-advent-calendar-in-english-2019/">F# Advent Calendar 2019</a>.
It&rsquo;s Christmas time!</em></p>
<p>Cloud is everywhere, and yet it&rsquo;s still inaccessible to millions of developers and IT pros. With shining yet cloudy eyes return they from KubeCon&rsquo;s and re:Invent&rsquo;s, just to pick up an issue in Jira, fix yet another <code>SingletonProxyFactoryBean</code> in their J2EE application, commit it to SVN, and hope it will be delivered in three months to the data center in their HQ basement.</p>
<p>But hey, it&rsquo;s December now, which means it&rsquo;s time to write a letter to Santa Cloud! Santa Cloud brings gifts to the homes of well-behaved engineers on the night of Christmas Eve. He accomplishes this feat with the aid of his elves, who make the toys in their glorious workshops in the State of Washington.</p>
<p><img src="elves.jpg" alt="Cloud Elves"></p>
<p>Here are some typical letters that Santa gets these days:</p>
<blockquote>I maintain 15 different apps, and each one has a custom deployment workflow. If only I had a <b>Kubernetes</b> cluster, I would stick all the apps in it and let the blue/green deployments do the magic!</blockquote>
<blockquote>My ten-year-old legacy application was designed for twenty users, and now it has to handle twenty thousand. It reached its performance limits! If only I could port it to <b>Serverless</b>, this would fix all my scalability issues.</blockquote>
<blockquote>
<p>We have 2 TB of data to analyze! Could you please send me a data lake and a <strong>Spark</strong> cluster? Actually, can I have two&hellip; or maybe three?</p></blockquote>
<p>There&rsquo;s enough cloud for everyone! Perhaps, a naughty engineer, who created a lot of technical debt and meeting invites, might only get a cozy single-core VM for their LAMP-stack website. But the lucky ones might get a whole Kubernetes cluster for themselves!</p>
<h2 id="behind-the-snow-curtains">Behind the Snow Curtains</h2>
<p>While cloud elves are good at provisioning the underlying hardware and providing services, Santa still needs to coordinate them to fulfill wishes. There are millions of aspiring cloud engineers, and all of them believe in Santa. It&rsquo;s not feasible to click the buttons in web portals or run ad-hoc scripts for each and every wishlist.</p>
<p>Luckily, Santa Cloud is good at programming and automation. He codes in <a href="https://fsharp.org">F#</a>, and he&rsquo;s one of the early customers of the .NET SDK for <a href="https://pulumi.com">Pulumi</a>. Hey, it&rsquo;s my fairy tale, so I choose the tech stack, thank you. Worry not, even if you are not familiar with F# or Pulumi, you will be able to follow along.</p>
<p>The workflow looks approximately like this:</p>
<ul>
<li>Represent a letter as a value in the program</li>
<li>Pick an elf which can fulfill the desire</li>
<li>Produce the resource</li>
<li>Wrap a note to the recipient</li>
</ul>
<h3 id="parsing-wishlists">Parsing wishlists</h3>
<p>Too bad, not every wishful engineer knows F#. Maybe, next year, Santa can make an online form that wouldn&rsquo;t accept anything but valid code. For now, it&rsquo;s the duty of Mrs. Cloud to read every letter and convert it to a list of records. Here is a sample:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> wishes = [
</span></span><span style="display:flex;"><span>    { Recipient = Person <span style="color:#a31515">&#34;Kelsey&#34;</span> ; Resource = Kubernetes (Nodes 25) }
</span></span><span style="display:flex;"><span>    { Recipient = Person <span style="color:#a31515">&#34;Jeff&#34;</span>   ; Resource = Serverless DotNet }
</span></span><span style="display:flex;"><span>    { Recipient = Person <span style="color:#a31515">&#34;Satoshi&#34;</span>; Resource = Blockchain Public }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>The value <code>wishes</code> is a strongly-typed list of records. Each record has multiple properties and utilizes &ldquo;algebraic data types&rdquo;: each type would have a label (&ldquo;Kubernetes&rdquo;) and an associated piece of data (25 nodes). The shape of data depends on the label: it&rsquo;s not possible to ask 25 nodes of serverless.</p>
<p>When the list is defined and compiled, it goes to production. But first, we need to assign an elf to each item in the list.</p>
<h3 id="elves">Elves</h3>
<p>All-powerful craftselves are represented as another F# type: a function type.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">type</span> <span style="color:#2b91af">Elf</span> = Wish -&gt; (<span style="color:#2b91af">unit</span> -&gt; Identifier) option
</span></span></code></pre></div><p>Here is what it tells us:</p>
<ul>
<li>It&rsquo;s a function which expects a <code>Wish</code> as an input parameter</li>
<li>It may return nothing if this elf can&rsquo;t fulfill the wish (represented by <code>option</code> type)</li>
<li>If it returns something, it returns yet another function&mdash;of type <code>unit -&gt; Identifier</code></li>
<li>This resulting function has a side effect (it accepts <code>unit</code>): the production of a cloud resource</li>
<li>It returns an <code>Identifier</code> of that resource</li>
</ul>
<p>Whoa, that&rsquo;s a lot of information conveyed by a single-line type definition!</p>
<p>In our program, each elf is a function, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> aws (wish: Wish) =
</span></span><span style="display:flex;"><span>    <span style="color:#00f">match</span> wish.Resource <span style="color:#00f">with</span>
</span></span><span style="display:flex;"><span>    | Kubernetes k8s -&gt; makeEksCluster k8s |&gt; Some
</span></span><span style="display:flex;"><span>    | Serverless s8s -&gt; makeAwsLambda s8s  |&gt; Some
</span></span><span style="display:flex;"><span>    <span style="color:#008000">//|  ... more resource types
</span></span></span><span style="display:flex;"><span><span style="color:#008000"></span>    | _ -&gt; None
</span></span></code></pre></div><p>The function matches the type of the desired resource and calls a corresponding resource provisioning routine.</p>
<h3 id="resource-provisioning">Resource provisioning</h3>
<p>Pulumi handles the creation of cloud resources with its .NET SDKs spanning across all major cloud providers.</p>
<p>Here is a snippet which defines an Azure Function App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> makeFunctionApp (Person name) (runtime: Runtime) () =
</span></span><span style="display:flex;"><span>    <span style="color:#00f">let</span> app =
</span></span><span style="display:flex;"><span>        FunctionApp(name,
</span></span><span style="display:flex;"><span>            FunctionAppArgs
</span></span><span style="display:flex;"><span>               (ResourceGroupName = io resourceGroup.Name,
</span></span><span style="display:flex;"><span>                AppSettings = inputMap [<span style="color:#a31515">&#34;runtime&#34;</span>, runtime.ToString() |&gt; input],
</span></span><span style="display:flex;"><span>                StorageConnectionString = io storageAccount.PrimaryConnectionString,
</span></span><span style="display:flex;"><span>                Version = input <span style="color:#a31515">&#34;~2&#34;</span>))
</span></span><span style="display:flex;"><span>    Url app.DefaultHostname
</span></span></code></pre></div><p>And here is a Google Kubernetes Engine cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> makeGkeCluster (Person name) (Nodes nodeCount) () =
</span></span><span style="display:flex;"><span>    <span style="color:#00f">let</span> masterVersion = input <span style="color:#a31515">&#34;1.15.1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">let</span> cluster =
</span></span><span style="display:flex;"><span>        Cluster(name,
</span></span><span style="display:flex;"><span>            ClusterArgs
</span></span><span style="display:flex;"><span>               (InitialNodeCount = input nodeCount,
</span></span><span style="display:flex;"><span>                MinMasterVersion = masterVersion,
</span></span><span style="display:flex;"><span>                NodeVersion = masterVersion,
</span></span><span style="display:flex;"><span>                NodeConfig = input (
</span></span><span style="display:flex;"><span>                    ClusterNodeConfigArgs
</span></span><span style="display:flex;"><span>                       (MachineType = input <span style="color:#a31515">&#34;n1-standard-1&#34;</span>))))
</span></span><span style="display:flex;"><span>    Url cluster.Endpoint
</span></span></code></pre></div><h3 id="production">Production</h3>
<p>The application logic of picking the right production facility and executing the order takes five lines of code.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> fulfill wish =
</span></span><span style="display:flex;"><span>    <span style="color:#008000">// Randomize the order of elves, so that they get equal opportunities
</span></span></span><span style="display:flex;"><span><span style="color:#008000"></span>    <span style="color:#00f">let</span> elves = shuffle [aws; azure; gcp]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">// Find the first elf which agrees to produce a resource
</span></span></span><span style="display:flex;"><span><span style="color:#008000"></span>    <span style="color:#00f">let</span> make = elves |&gt; List.pick (<span style="color:#00f">fun</span> elf -&gt; elf wish)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">// Run the production!
</span></span></span><span style="display:flex;"><span><span style="color:#008000"></span>    <span style="color:#00f">let</span> identifier = make()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    wish.Recipient, identifier
</span></span></code></pre></div><p>We shuffle the order of elves to give them comparable workload, pick the first one in the list who agrees to execute the order, run the provisioning, and return the recipient name with their shiny resource identifier.</p>
<p>Go team Santa!</p>
<h3 id="delivery">Delivery</h3>
<p>For a nice personal touch, a card needs to be printed, gift-wrapped, and delivered by Santa and reindeers. Programming the reindeers is for another blog post. For now, we just return a list of tuples of person names and resource URLs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> send (responses: Response <span style="color:#2b91af">list</span>) =
</span></span><span style="display:flex;"><span>    responses
</span></span><span style="display:flex;"><span>    |&gt; List.map (<span style="color:#00f">fun</span> (Person name, Url url) -&gt; name, url)
</span></span><span style="display:flex;"><span>    |&gt; dict
</span></span></code></pre></div><p>Finally, another line combines the steps into the workflow:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span><span style="color:#00f">let</span> santaCloud () = wishes |&gt; (List.map fulfill) |&gt; send
</span></span></code></pre></div><p>And the last line defines the entry point of the application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fsharp" data-lang="fsharp"><span style="display:flex;"><span>[&lt;EntryPoint&gt;]
</span></span><span style="display:flex;"><span><span style="color:#00f">let</span> main _ = Deployment.run santaCloud
</span></span></code></pre></div><p>Running the program produces an output like this:</p>
<p><img src="pulumiup.png" alt="Pulumi Console Output"></p>
<h2 id="retrospective">Retrospective</h2>
<p>Honestly, the system is brand-new this year, so we still need to see how it plays out on Christmas Eve. Regardless, we learned a thing or two today:</p>
<ul>
<li><strong>Types</strong>: F# has an excellent type system that allows expressing domain terms concisely and precisely.</li>
<li><strong>Logic</strong>: The program workflow is expressed in terms of function calls, pattern matching, and collections manipulation.</li>
<li><strong>Infrastructure</strong>: Cloud resources are defined in F# with Pulumi .NET SDK, which supports pretty much any resource in any cloud.</li>
<li><strong>Application</strong>: Blended together, these components enable writing expressive, cohesive, maintainable, cloud-native applications using familiar and loved tools and practices.</li>
</ul>
<p>Learn more about <a href="https://pulumi.com/dotnet">Pulumi for .NET</a> or browse <a href="https://github.com/mikhailshilkov/fsharp-advent-pulumi/tree/master/2019">the full code</a> for this example.</p>
<p>Merry Cloudsmas, ho-ho-ho!</p>

                </div>

                
                <div class="after-post-tags">
                    <ul class="tags">
                        
                        <li>
                            
                            
                            <a href="/tags/pulumi">Pulumi</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/fsharp">F#</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/aws">AWS</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/azure">Azure</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/gcp">GCP</a>
                            
                        </li>
                        
                    </ul>
                </div>
                

                <hr/>

            </div>
            
        </div>
    </div>
    
    <div class="container">
    <div id="sharepane" class="row justify-content-center">
        <div class="col-md-2">

        </div>
        <div class="contact-intro col-md-2 text-center">
            <img class="profile-small d-inline-block mx-auto rounded-circle mb-3" height="100px"
                src="/images/author.jpg" alt="">
        </div>
        <div class="col-md-8">
            <section class="article-open_author">
                <div class="article-open_author_bio">
                    <h5 itemprop="author" itemscope="" itemtype="http://schema.org/Person">Author: Mikhail Shilkov</h5>
                    <p>
                        <div>Cloud and AI developer and researcher.</div><div>Principal engineer at Pulumi.</div>
                    </p>
                </div>
            </section>
            <a href="https://x.com/MikhailShilkov?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @MikhailShilkov</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
    </div>
</div>
<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">
            
            <div class="mb-5">
                <h5 class="float-left">Responses</h5>
                <div class="float-right"><a
                        href='https://github.com/mikhailshilkov/mikhailio-hugo/issues/25'>Write a
                        response</a></div>
            </div>
            <div id="gh-comments-list" style="display: none">25</div>
            <div class="mt-4">Visit the <b><a
                        href='https://github.com/mikhailshilkov/mikhailio-hugo/issues/25'>Github
                        Issue</a></b> to comment on this page</div>
            
        </div>
    </div>
</div>
</div>

        </div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Mikhail Shilkov - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>











<script src="/js/bundle.min.js"></script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-NL7F82LX48"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-NL7F82LX48');
        }
      </script>
    </body>
</html>

<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link rel="icon" type="image/png" href="/favicon.ico">
	
	
	<title>Function App | Mikhail Shilkov</title>
	
	
	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	
	<link rel="stylesheet" href="/sass/main.css">

	
	
	<meta property="og:title" content="Function App" />
	<meta property="og:description" content="Finally, it&rsquo;s time to create the main component of our serverless application: the Function App. Define it with the following snippet:
const app = new azure.appservice.FunctionApp(&#34;fa&#34;, {
    resourceGroupName: /*TODO: reference the rg name*/,
    appServicePlanId: /*TODO: reference the plan id*/,
    storageConnectionString: /*TODO: reference the storage account primaryConnectionString*/,
    version: &#34;~2&#34;,
});
Fill in the TODO blocks as the hint suggests. Once done, try deploying the updated program and make sure it succeeds." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://mikhail.io/lab/pulumi/6-functionapp/" />

	
	
	
	


	
	

	
	
	<meta name="twitter:card" content="summary"/>
	
	

	<meta name="twitter:title" content="Function App"/>
	<meta name="twitter:description" content="Finally, it&rsquo;s time to create the main component of our serverless application: the Function App. Define it with the following snippet:
const app = new azure.appservice.FunctionApp(&#34;fa&#34;, {
    resourceGroupName: /*TODO: reference the rg name*/,
    appServicePlanId: /*TODO: reference the plan id*/,
    storageConnectionString: /*TODO: reference the storage account primaryConnectionString*/,
    version: &#34;~2&#34;,
});
Fill in the TODO blocks as the hint suggests. Once done, try deploying the updated program and make sure it succeeds."/>
	<meta name="twitter:creator" content="@MikhailShilkov"></meta>
</head>
<body><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    function addChart(make) {
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            const data = new google.visualization.DataTable();

            const options = {
                height: 420,  
                chartArea: { width: '85%', height: '70%' },
                legend: 'none',
                hAxis: { minValue: 0 },
                vAxis: {},
                series: {      
                    0: { tooltip : false}
                }
            };
            const chart = make(data, options);
            options.hAxis.textStyle = options.hAxis.titleTextStyle 
                = options.vAxis.textStyle = options.vAxis.titleTextStyle = { fontName: 'Merriweather' };

            chart.draw(data, options);
        }
    }
</script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container pr-0">
        <a class="navbar-brand" href="/">
            <img class="author-thumb" src="/images/author.jpg" alt="Mikhail Shilkov">
            <span class="text-primary">Mikhail Shilkov</span>
        </a>

        
               


        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">TOPICS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/archives/">ARCHIVES</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/talks/">TALKS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">ABOUT</a>
                </li>
                <li class="nav-item">
    <a class="nav-link" href="https://mikhail.io/feed/"><i class="fas fa-rss social-icon" aria-hidden="true"></i></a>
</li>

<li class="nav-item">
    <a class="nav-link" href="https://x.com/MikhailShilkov"><i class="fab fa-twitter social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://dev.to/mikhailshilkov"><i class="fab fa-dev social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://medium.com/@MikhailShilkov"><i class="fab fa-medium social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://github.com/MikhailShilkov"><i class="fab fa-github social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/MikhailShilkov"><i class="fab fa-linkedin social-icon" aria-hidden="true"></i></a>
</li>

</ul>
        </div>
        
    </div>
</nav>


        <div class="container">

<div class="main-content">
    
    <div class="container">
        <div class="row">
            
            <div class="col-lg-3 pl-0">
                <nav class="sidebar">
                    <div class="sidebar-header">
                        <h3>Learn Pulumi</h3>
                    </div>

                    <ul class="list-unstyled components">
                        <p>to deploy Azure Functions and co.</p>
                        <li>
                            <a href="..">Introduction</a>
                        </li>
                        
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/1-prerequisites/">1. Prerequisites</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/2-newstack/">2. New Pulumi Program</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/3-resourcegroup/">3. Resource Group</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/4-storageaccount/">4. Storage Account</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/5-consumptionplan/">5. Consumption Plan</a>
                            
                        </li>
                        
                        <li>
                            
                            <span class="current">6. Function App</span>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/7-outputs/">7. Outputs</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/8-configs/">8. Configuration</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/9-archiveapp/">9. Archive App</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/10-customcode/">10. Custom Code</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/11-callbackapp/">11. Callback App</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/12-furthersteps/">12. Further Steps</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/13-cleanup/">13. Clean Up</a>
                            
                        </li>
                        
                    </ul>
                </nav>
            </div>
            
            <div class="col-lg-8 offset-lg-1 flex-first flex-lg-unordered">

                <div class="mainheading">
                    
                    <h1 class="posttitle">Function App</h1>
                    
                    <div class="post-top-meta">
                        <div>
                            <span class="post-date"> 5 minutes to complete</span>
                        </div>
                    </div>
                </div>

                
                <div class="article-post">
                    <p>Finally, it&rsquo;s time to create the main component of our serverless application: the Function App. Define it with the following snippet:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#00f">const</span> app = <span style="color:#00f">new</span> azure.appservice.FunctionApp(<span style="color:#a31515">&#34;fa&#34;</span>, {
</span></span><span style="display:flex;"><span>    resourceGroupName: <span style="color:#008000">/*TODO: reference the rg name*/</span>,
</span></span><span style="display:flex;"><span>    appServicePlanId: <span style="color:#008000">/*TODO: reference the plan id*/</span>,
</span></span><span style="display:flex;"><span>    storageConnectionString: <span style="color:#008000">/*TODO: reference the storage account primaryConnectionString*/</span>,
</span></span><span style="display:flex;"><span>    version: <span style="color:#a31515">&#34;~2&#34;</span>,
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Fill in the TODO blocks as the hint suggests. Once done, try deploying the updated program and make sure it succeeds.</p>
<h2 id="application-settings">Application settings</h2>
<p>The deployment may succeed, but the application isn&rsquo;t ready yet. It&rsquo;s missing several application settings. Add a property <code>appSettings</code> inside the Function App resource:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#00f">const</span> app = <span style="color:#00f">new</span> azure.appservice.FunctionApp(<span style="color:#a31515">&#34;fa&#34;</span>, {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    appSettings: {
</span></span><span style="display:flex;"><span>        FUNCTIONS_WORKER_RUNTIME: <span style="color:#a31515">&#34;node&#34;</span>,
</span></span><span style="display:flex;"><span>        WEBSITE_NODE_DEFAULT_VERSION: <span style="color:#a31515">&#34;10.14.1&#34;</span>,
</span></span><span style="display:flex;"><span>        WEBSITE_RUN_FROM_PACKAGE: <span style="color:#a31515">&#34;https://mikhailworkshop.blob.core.windows.net/zips/app.zip&#34;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>The top two settings configure the app to run on Node.js v10 runtime.</p>
<p>The bottom one deploys the code to the Function App. This setting tells the app to load the specified zip file, extract the code from it, discover the functions, and run them. I&rsquo;ve prepared this zip file for you to get started faster, you can find its code <a href="https://github.com/mikhailshilkov/mikhailio-hugo/tree/master/content/lab/materials/app">here</a>. The code contains a single HTTP-triggered Azure Function.</p>
<p>You don&rsquo;t need to configure application settings related to Azure Storage connections explicitly: the <code>storageConnectionString</code> property takes care of this.</p>
<h2 id="checkpoint">Checkpoint</h2>
<p>Deploy the changes with <code>pulumi up</code>. Run <code>az resource list -g pulumi-workshop -o table</code> and note the actual name of your Function App, something like <code>fa123456ab</code>.</p>
<p>Make the URL of the following shape: <code>https://&lt;your function app name&gt;.azurewebsites.net/api/hello</code>. Send an HTTP request to the endpoint either via a browser or with a <code>curl</code> command:</p>
<pre tabindex="0"><code>$ curl https://fa123456ab.azurewebsites.net/api/hello
You&#39;ve successfully deployed a Function App!
</code></pre><p>Congratulations! You have deployed the complete infrastructure to run a Function App.</p>


                    
                    <p>If you have any difficulties, compare your code with <a href="index.ts" target="blank">this
                            sample</a>.</p>
                    

                    
                    
                    <h2>Next Step</h2>
                    <a href="https://mikhail.io/lab/pulumi/7-outputs/">
                        <button type="button" class="btn btn-primary btn-lg">
                            
                            Get the Function App endpoint with Outputs
                            
                        </button>
                    </a>
                    
                    
                </div>

                
                <div class="after-post-tags">
                    <ul class="tags">
                        
                    </ul>
                </div>
                

            </div>
            
        </div>
    </div>
    
    
</div>

        </div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Mikhail Shilkov - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>











<script src="/js/bundle.min.js"></script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-MJW7RC6EV4"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-MJW7RC6EV4');
        }
      </script>
    </body>
</html>

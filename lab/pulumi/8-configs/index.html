<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link rel="icon" type="image/png" href="/favicon.ico">
	
	
	<title>Configuration | Mikhail Shilkov</title>
	
	
	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	
	<link rel="stylesheet" href="/sass/main.css">

	
	
	<meta property="og:title" content="Configuration" />
	<meta property="og:description" content="We created a working Pulumi program that generates a random name for the Function App. This might not be desirable: maybe, we want to control the name. Hard-coding the name in the program may limit its reusability: for example, you wouldn&rsquo;t be able to use the same program to deploy to multiple environments like production and staging." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://mikhail.io/lab/pulumi/8-configs/" />

	
	
	
	


	
	

	
	
	<meta name="twitter:card" content="summary"/>
	
	

	<meta name="twitter:title" content="Configuration"/>
	<meta name="twitter:description" content="We created a working Pulumi program that generates a random name for the Function App. This might not be desirable: maybe, we want to control the name. Hard-coding the name in the program may limit its reusability: for example, you wouldn&rsquo;t be able to use the same program to deploy to multiple environments like production and staging."/>
	<meta name="twitter:creator" content="@MikhailShilkov"></meta>
</head>
<body><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    function addChart(make) {
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            const data = new google.visualization.DataTable();

            const options = {
                height: 420,  
                chartArea: { width: '85%', height: '70%' },
                legend: 'none',
                hAxis: { minValue: 0 },
                vAxis: {},
                series: {      
                    0: { tooltip : false}
                }
            };
            const chart = make(data, options);
            options.hAxis.textStyle = options.hAxis.titleTextStyle 
                = options.vAxis.textStyle = options.vAxis.titleTextStyle = { fontName: 'Merriweather' };

            chart.draw(data, options);
        }
    }
</script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container pr-0">
        <a class="navbar-brand" href="/">
            <img class="author-thumb" src="/images/author.jpg" alt="Mikhail Shilkov">
            <span class="text-primary">Mikhail Shilkov</span>
        </a>

        
               


        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">TOPICS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/archives/">ARCHIVES</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/talks/">TALKS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">ABOUT</a>
                </li>
                <li class="nav-item">
    <a class="nav-link" href="https://mikhail.io/feed/"><i class="fas fa-rss social-icon" aria-hidden="true"></i></a>
</li>

<li class="nav-item">
    <a class="nav-link" href="https://www.twitter.com/MikhailShilkov"><i class="fab fa-twitter social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://dev.to/mikhailshilkov"><i class="fab fa-dev social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://medium.com/@MikhailShilkov"><i class="fab fa-medium social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://github.com/MikhailShilkov"><i class="fab fa-github social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/MikhailShilkov"><i class="fab fa-linkedin social-icon" aria-hidden="true"></i></a>
</li>

</ul>
        </div>
        
    </div>
</nav>


        <div class="container">

<div class="main-content">
    
    <div class="container">
        <div class="row">
            
            <div class="col-lg-3 pl-0">
                <nav class="sidebar">
                    <div class="sidebar-header">
                        <h3>Learn Pulumi</h3>
                    </div>

                    <ul class="list-unstyled components">
                        <p>to deploy Azure Functions and co.</p>
                        <li>
                            <a href="..">Introduction</a>
                        </li>
                        
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/1-prerequisites/">1. Prerequisites</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/2-newstack/">2. New Pulumi Program</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/3-resourcegroup/">3. Resource Group</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/4-storageaccount/">4. Storage Account</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/5-consumptionplan/">5. Consumption Plan</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/6-functionapp/">6. Function App</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/7-outputs/">7. Outputs</a>
                            
                        </li>
                        
                        <li>
                            
                            <span class="current">8. Configuration</span>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/9-archiveapp/">9. Archive App</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/10-customcode/">10. Custom Code</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/11-callbackapp/">11. Callback App</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/12-furthersteps/">12. Further Steps</a>
                            
                        </li>
                        
                        <li>
                            
                            <a href="https://mikhail.io/lab/pulumi/13-cleanup/">13. Clean Up</a>
                            
                        </li>
                        
                    </ul>
                </nav>
            </div>
            
            <div class="col-lg-8 offset-lg-1 flex-first flex-lg-unordered">

                <div class="mainheading">
                    
                    <h1 class="posttitle">Configuration</h1>
                    
                    <div class="post-top-meta">
                        <div>
                            <span class="post-date"> 6 minutes to complete</span>
                        </div>
                    </div>
                </div>

                
                <div class="article-post">
                    <p>We created a working Pulumi program that generates a random name for the Function App. This might not be desirable: maybe, we want to control the name. Hard-coding the name in the program may limit its reusability: for example, you wouldn&rsquo;t be able to use the same program to deploy to multiple environments like production and staging.</p>
<p>The same applies to the name and location of the Resource Group. Environments would clash on the name. If you choose to deploy to another Azure region, you have to change the code.</p>
<p>Let&rsquo;s learn how to parameterize your Pulumi program.</p>
<h2 id="config-command">Config command</h2>
<p>The <code>pulumi config</code> CLI command can save some values as configuration parameters. Run the following commands to set the names for the Resource Group and the Function App:</p>
<pre tabindex="0"><code>$ pulumi config set rgName pulumi-workshop
$ pulumi config set appName &lt;myuniquename&gt;
</code></pre><p>You have to come up with a globally unique name for the Function App.</p>
<p>There are also several built-in configuration values. For example, <code>azure:location</code> setting defines the default Azure region for all Resource Groups that don&rsquo;t have an explicit <code>location</code> value:</p>
<pre tabindex="0"><code>$ pulumi config set azure:location westus
</code></pre><h2 id="read-config-values">Read config values</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#00f">const</span> config = <span style="color:#00f">new</span> pulumi.Config();
</span></span><span style="display:flex;"><span><span style="color:#00f">const</span> rgName = config.<span style="color:#00f">get</span>(<span style="color:#a31515">&#34;rgName&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#00f">const</span> appName = config.<span style="color:#00f">get</span>(<span style="color:#a31515">&#34;appName&#34;</span>);
</span></span></code></pre></div><p>Now change the definition of the Resource Group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#00f">const</span> resourceGroup = <span style="color:#00f">new</span> azure.core.ResourceGroup(<span style="color:#a31515">&#34;pulumi-workshop&#34;</span>, {
</span></span><span style="display:flex;"><span>    name: <span style="color:#2b91af">rgName</span>,
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>and the Function App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#00f">const</span> app = <span style="color:#00f">new</span> azure.appservice.FunctionApp(<span style="color:#a31515">&#34;fa&#34;</span>, {
</span></span><span style="display:flex;"><span>    resourceGroupName: <span style="color:#2b91af">resourceGroup.name</span>,
</span></span><span style="display:flex;"><span>    name: <span style="color:#2b91af">appName</span>,
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Note that <code>get</code> reads an optional value: if you omit the configuration value, the names fall back to auto-generated ones. <code>config.require</code> can be used to read the mandatory values.</p>
<p>We don&rsquo;t set the <code>location</code> property of any of our resources anymore. Therefore, the <code>azure:location</code> configuration value is required now.</p>
<h2 id="apply-the-changes">Apply the changes</h2>
<p>Run `pulumi preview command to see which changes are planned. You should get this output:</p>
<pre tabindex="0"><code>Previewing update (dev):
    Type                             Name                 Plan        Info
    pulumi:pulumi:Stack              pulumi-workshop-dev
+-  └─ azure:appservice:FunctionApp  fa                   replace     [diff: ~name]

    +-1 to replace
    4 unchanged
</code></pre><p>Note that I kept the logical names of the Resource Group and the Function App: <code>pulumi-workshop</code> and <code>fa</code>. Pulumi keeps the previous state of all resources in its state file, so it&rsquo;s able to compare the old state with the new program and calculate the transition plan. I haven&rsquo;t renamed my Resource Group, but the name of the Function App has changed from an auto-generated one to the configured one. Therefore, Pulumi is about to re-create the Function App with a new physical name.</p>
<p>If you preview matches these expectations, go ahead and run <code>pulumi up</code>. In general, you should always understand the preview before you hit &lsquo;yes&rsquo;.</p>
<h2 id="checkpoint">Checkpoint</h2>
<p>Send an HTTP request to the new application endpoint and make sure it still returns a greeting.</p>


                    
                    <p>If you have any difficulties, compare your code with <a href="index.ts" target="blank">this
                            sample</a>.</p>
                    

                    
                    
                    <h2>Next Step</h2>
                    <a href="https://mikhail.io/lab/pulumi/9-archiveapp/">
                        <button type="button" class="btn btn-primary btn-lg">
                            
                            Use a High-level Component
                            
                        </button>
                    </a>
                    
                    
                </div>

                
                <div class="after-post-tags">
                    <ul class="tags">
                        
                    </ul>
                </div>
                

            </div>
            
        </div>
    </div>
    
    
</div>

        </div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Mikhail Shilkov - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>











<script src="/js/bundle.min.js"></script>
    </body>
</html>

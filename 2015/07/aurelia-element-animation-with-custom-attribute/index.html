<!DOCTYPE html>
<html lang="en-us" prefix="og: http://ogp.me/ns#"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link rel="icon" type="image/png" href="/favicon.ico">
	
	
	<title>Aurelia element animation with custom attribute | Mikhail Shilkov</title>
	
	
	
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	
	<link rel="stylesheet" href="/sass/main.css">

	
	
	<meta property="og:title" content="Aurelia element animation with custom attribute" />
	<meta property="og:description" content="I&#39;ve been exploring Aurelia javascript UI framework recently to get some experience needed for our next big project. One thing that I couldn&#39;t implement out of the box was a kind of animation." />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://mikhail.io/2015/07/aurelia-element-animation-with-custom-attribute/" />

	
	
	
	


	
	
	<meta property="article:tag" content="Javascript" />
	
	<meta property="article:tag" content="Aurelia" />
	
	<meta property="article:tag" content="Animation" />
	

	
	
	<meta name="twitter:card" content="summary"/>
	
	

	<meta name="twitter:title" content="Aurelia element animation with custom attribute"/>
	<meta name="twitter:description" content="I&#39;ve been exploring Aurelia javascript UI framework recently to get some experience needed for our next big project. One thing that I couldn&#39;t implement out of the box was a kind of animation."/>
	<meta name="twitter:creator" content="@MikhailShilkov"></meta>
</head>
<body><script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load("current", {packages:["corechart"]});
    function addChart(make) {
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            const data = new google.visualization.DataTable();

            const options = {
                height: 420,  
                chartArea: { width: '85%', height: '70%' },
                legend: 'none',
                hAxis: { minValue: 0 },
                vAxis: {},
                series: {      
                    0: { tooltip : false}
                }
            };
            const chart = make(data, options);
            options.hAxis.textStyle = options.hAxis.titleTextStyle 
                = options.vAxis.textStyle = options.vAxis.titleTextStyle = { fontName: 'Merriweather' };

            chart.draw(data, options);
        }
    }
</script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container pr-0">
        <a class="navbar-brand" href="/">
            <img class="author-thumb" src="/images/author.jpg" alt="Mikhail Shilkov">
            <span class="text-primary">Mikhail Shilkov</span>
        </a>

        
               


        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                
                <li class="nav-item ">
                    <a class="nav-link" href="/tags/">TOPICS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/archives/">ARCHIVES</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/talks/">TALKS</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link" href="/about/">ABOUT</a>
                </li>
                <li class="nav-item">
    <a class="nav-link" href="https://mikhail.io/feed/"><i class="fas fa-rss social-icon" aria-hidden="true"></i></a>
</li>

<li class="nav-item">
    <a class="nav-link" href="https://www.twitter.com/MikhailShilkov"><i class="fab fa-twitter social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://dev.to/mikhailshilkov"><i class="fab fa-dev social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://medium.com/@MikhailShilkov"><i class="fab fa-medium social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://github.com/MikhailShilkov"><i class="fab fa-github social-icon" aria-hidden="true"></i></a>
</li>


<li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/MikhailShilkov"><i class="fab fa-linkedin social-icon" aria-hidden="true"></i></a>
</li>

</ul>
        </div>
        
    </div>
</nav>


        <div class="container">

<div class="main-content">
    
    <div class="container">
        <div class="row">
            
            <div class="col-lg-2 pl-0"><div class="share">
    <ul>
        <li class="ml-1 mr-1" title="Say 'Thank You' for this article">
            <a href="#" onclick="heart();return false;">
                <i class="fas fa-heart" style="color: red"></i>
            </a>
            <div class="count" style="float: right; padding-left: .5em; padding-top: .25em" id="heartcount"></div>
        </li>

        <li class="ml-1 mr-1" title="Tweet this article">
            <a target="_blank"
                href="https://twitter.com/intent/tweet?text=Aurelia%20element%20animation%20with%20custom%20attribute%20by%20@MikhailShilkov&url=https%3a%2f%2fmikhail.io%2f2015%2f07%2faurelia-element-animation-with-custom-attribute%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1" title="See the responses or write a response">
            <a href="#comments">
                <i class="fas fa-comment"></i>
            </a>
        </li>
    </ul>
</div></div>
            
            <div class="col-lg-9 flex-first flex-lg-unordered">

                <div class="mainheading">
                    
                    <h1 class="posttitle">Aurelia element animation with custom attribute</h1>
                    
                    <div class="post-top-meta">
                        <div>
                            
                                
                                <span class="post-date">Published on Jul 28, 2015
                                
                            
                            
                        &nbsp;&middot;&nbsp; 3 min read</span></span>
                        </div>
                    </div>
                </div>
                
                
                

                
                <div class="article-post">
                    <p>I&rsquo;ve been exploring <a href="http://aurelia.io">Aurelia</a> javascript UI framework recently to get some experience needed
for our next big project. One thing that I couldn&rsquo;t implement out of the box was a kind
of animation.</p>
<p>I have a grid of values bound to View Model. View Model communicates to server, receives
any updates of data and the grid got immediately updated, all that works great with Aurelia.
Now I want to highlight the cell which has just received an updated value with a small
background animation, like this:</p>
<p><img src="animation.gif" alt="Updated cell animation"></p>
<p>Aurelia has a library called <a href="https://github.com/aurelia/animator-css">aurelia-animator-css</a> with a helper
class to run CSS animation. If you use it directly in your View Model, you will end up with the code like</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#00f">this</span>.newMessageReceived =
</span></span><span style="display:flex;"><span>    msg =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.data.filter(i =&gt; i.id === msg.id).forEach(t =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#00f">let</span> editedItemIdx = <span style="color:#00f">this</span>.data.indexOf(i);
</span></span><span style="display:flex;"><span>            <span style="color:#00f">var</span> elem = <span style="color:#00f">this</span>.element.querySelectorAll(<span style="color:#a31515">&#39;tbody tr&#39;</span>)[editedItemIdx + 1]
</span></span><span style="display:flex;"><span>                                   .querySelectorAll(<span style="color:#a31515">&#39;td&#39;</span>)[3];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#00f">this</span>.animator.addClass(elem, <span style="color:#a31515">&#39;background-animation&#39;</span>).then(() =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#00f">this</span>.animator.removeClass(elem, <span style="color:#a31515">&#39;background-animation&#39;</span>);
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><p>So we get a new message, find the related item in our data, then find the index of that data. Then we use this
index in query selector to get the exact row that needs animation, find the cell by hard coded index, and
finally use animator to highlight the background.</p>
<p>Ouch&hellip; That smells. We spoiled our view model with view details, and all this code is very ugly and fragile.</p>
<p>Good news: we can improve the solution with the Aurelia&rsquo;s feature called Custom Attributes. Let&rsquo;s create a new
javascript file and call it <code>animateonchange.js</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#00f">import</span> {customAttribute} from <span style="color:#a31515">&#39;aurelia-framework&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">@</span>customAttribute(<span style="color:#a31515">&#39;animateonchange&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#00f">export</span> <span style="color:#00f">class</span> AnimateOnChangeCustomAttribute {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I declared a class for our new attribute, so far it&rsquo;s empty. I imported customAttribute decorator from
Aurelia framework: that the way we can define a name for our custom attribute. This can be avoided: if I
change the name to <code>AnimateonchangeCustomAttribute</code>, Aurelia will infer the name from class name, but I want
to stay explicit and keep the class name readable. Note that capital letters are not allowed in attribute name.</p>
<p>Now, let&rsquo;s declare the constructor of the new class and inject all the dependencies:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#00f">import</span> {inject, customAttribute} from <span style="color:#a31515">&#39;aurelia-framework&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#00f">import</span> {CssAnimator} from <span style="color:#a31515">&#39;aurelia-animator-css&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">@</span>customAttribute(<span style="color:#a31515">&#39;animateonchange&#39;</span>)
</span></span><span style="display:flex;"><span><span style="">@</span>inject(Element, CssAnimator)
</span></span><span style="display:flex;"><span><span style="color:#00f">export</span> <span style="color:#00f">class</span> AnimateOnChangeCustomAttribute {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    constructor(element, animator) {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.element = element;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.animator = animator;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I used dependency injection to get attribute&rsquo;s element and CSS animator and save them into class fields.
Here&rsquo;s how to use them:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#00f">import</span> {inject, customAttribute} from <span style="color:#a31515">&#39;aurelia-framework&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#00f">import</span> {CssAnimator} from <span style="color:#a31515">&#39;aurelia-animator-css&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">@</span>customAttribute(<span style="color:#a31515">&#39;animateonchange&#39;</span>)
</span></span><span style="display:flex;"><span><span style="">@</span>inject(Element, CssAnimator)
</span></span><span style="display:flex;"><span><span style="color:#00f">export</span> <span style="color:#00f">class</span> AnimateOnChangeCustomAttribute {
</span></span><span style="display:flex;"><span>    constructor(element, animator) {
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.element = element;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.animator = animator;
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.initialValueSet = <span style="color:#00f">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    valueChanged(newValue){
</span></span><span style="display:flex;"><span>        <span style="color:#00f">if</span> (<span style="color:#00f">this</span>.initialValueSet) {
</span></span><span style="display:flex;"><span>            <span style="color:#00f">this</span>.animator.addClass(<span style="color:#00f">this</span>.element, <span style="color:#a31515">&#39;background-animation&#39;</span>).then(() =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#00f">this</span>.animator.removeClass(<span style="color:#00f">this</span>.element, <span style="color:#a31515">&#39;background-animation&#39;</span>);
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#00f">this</span>.initialValueSet = <span style="color:#00f">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The new method <code>valueChanged</code> will be called every time the bound value changes. I want to ignore the
first value (it&rsquo;s not an update yet), so I did that with <code>initialValueSet</code> flag. Then I just run CSS
animator. No DOM-related queries!</p>
<p>Here is how we use the custom attribute from a view:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;template&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;require from=<span style="color:#a31515">&#34;./animateonchange&#34;</span>&gt;&lt;/require&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &lt;table class=<span style="color:#a31515">&#34;table&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;tr repeat<span style="">.</span>for=<span style="color:#a31515">&#34;item of data&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;td&gt;${item.value1}&lt;/td&gt;
</span></span><span style="display:flex;"><span>            &lt;td&gt;${item.value2}&lt;/td&gt;
</span></span><span style="display:flex;"><span>            &lt;td animateonchange<span style="">.</span>bind=<span style="color:#a31515">&#34;item.value3ToUpdate&#34;</span>&gt;${item.value3ToUpdate}&lt;/td&gt;
</span></span><span style="display:flex;"><span>            &lt;td&gt;${item.value4}&lt;/td&gt;
</span></span><span style="display:flex;"><span>        &lt;/tr&gt;
</span></span><span style="display:flex;"><span>    &lt;/table&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/template&gt;
</span></span></code></pre></div><p>First, we use <code>require</code> element to import custom attribute definition (make sure the path is correct
and no <code>.js</code> extension is present).</p>
<p>Second, we use <code>animateonchange.bind</code> to bind the value to the custom attributes. And it works!</p>
<p>Of course, you need to define the CSS class, e.g.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>.<span style="color:#2b91af">background-animation-add</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">-webkit-</span><span style="color:#00f">animation</span>: changeBack 0.5<span style="color:#2b91af">s</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#00f">animation</span>: changeBack 0.5<span style="color:#2b91af">s</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.<span style="color:#2b91af">background-animation-remove</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#00f">-webkit-</span><span style="color:#00f">animation</span>: fadeIn 0.5<span style="color:#2b91af">s</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#00f">animation</span>: fadeIn 0.5<span style="color:#2b91af">s</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>@<span style="color:#00f">-webkit-keyframes</span> changeBack {
</span></span><span style="display:flex;"><span>    0% { <span style="color:#00f">background-color</span>: <span style="color:#00f">white</span>; }
</span></span><span style="display:flex;"><span>    50% { <span style="color:#00f">background-color</span>: <span style="color:#00f">lightgreen</span>; }
</span></span><span style="display:flex;"><span>    100% { <span style="color:#00f">background-color</span>: <span style="color:#00f">white</span>; }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>@<span style="color:#00f">keyframes</span> changeBack {
</span></span><span style="display:flex;"><span>    0% { <span style="color:#00f">background-color</span>: <span style="color:#00f">white</span>; }
</span></span><span style="display:flex;"><span>    50% { <span style="color:#00f">background-color</span>: <span style="color:#00f">lightgreen</span>; }
</span></span><span style="display:flex;"><span>    100% { <span style="color:#00f">background-color</span>: <span style="color:#00f">white</span>; }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here is a <a href="http://plnkr.co/edit/oa0Kb1hf6D9M2jl22vWD">plunkr link to a complete example</a></p>
<p>Happy coding!</p>
<p>Useful links:</p>
<ul>
<li>
<p><a href="http://aurelia.io/docs.html#custom-attributes">Aurelia Custom Attributes documentation</a></p>
</li>
<li>
<p><a href="http://blog.durandal.io/2015/07/17/animating-apps-with-aurelia-part-1/">Animating Apps with Aurelia - Part 1 by Rob Eisenberg</a></p>
</li>
</ul>

                </div>

                
                <div class="after-post-tags">
                    <ul class="tags">
                        
                        <li>
                            
                            
                            <a href="/tags/javascript">Javascript</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/aurelia">Aurelia</a>
                            
                        </li>
                        
                        <li>
                            
                            
                            <a href="/tags/animation">Animation</a>
                            
                        </li>
                        
                    </ul>
                </div>
                

                <hr/>

            </div>
            
        </div>
    </div>
    
    <div class="container">
    <div id="sharepane" class="row justify-content-center">
        <div class="col-md-2">

        </div>
        <div class="contact-intro col-md-2 text-center">
            <img class="profile-small d-inline-block mx-auto rounded-circle mb-3" height="100px"
                src="/images/author.jpg" alt="">
        </div>
        <div class="col-md-8">
            <section class="article-open_author">
                <div class="article-open_author_bio">
                    <h5 itemprop="author" itemscope="" itemtype="http://schema.org/Person">Author: Mikhail Shilkov</h5>
                    <p>
                        <div>Cloud developer and researcher.</div><div>Software engineer at Pulumi. Microsoft Azure MVP.</div>
                    </p>
                </div>
            </section>
            <a href="https://twitter.com/MikhailShilkov?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @MikhailShilkov</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
        </div>
    </div>
</div>
<div class="container">
    <div id="comments" class="row justify-content-center mb-5">
        <div class="col-md-8">
            
            <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "mikhailio" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            
        </div>
    </div>
</div>
</div>

        </div>
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Mikhail Shilkov - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                
            </div>
        </div>
    </div>
</footer>











<script src="/js/bundle.min.js"></script>
    </body>
</html>
